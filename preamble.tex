\documentclass[a4paper,10pt,twoside]{memoir}
\usepackage{titlesec}
\usepackage{url}
\usepackage{cite}
\usepackage{physics}
\usepackage{upgreek}
\usepackage{lipsum}
\usepackage[xetex]{rotating}
\usepackage[xetex]{graphicx}
%\usepackage[xetex,draft]{graphicx} %uncomment to compile in draft mode - no images, faster
% \usepackage[font=small,format=plain,labelfont=bf,up,textfont=up]{caption}
\usepackage{amsmath}
\usepackage{mathspec}
\setmathfont(Digits,Latin)[Uppercase=Italic,Lowercase=Italic]{Minion Pro}
\setmathfont(Greek)[Uppercase=Regular,Lowercase=Regular]{Minion Pro}
\setmainfont[Mapping=tex-text, Contextuals=Alternate,Numbers=OldStyle]{Garamond Premier Pro}
\setmonofont{Ubuntu Mono}
\usepackage{geometry}
\usepackage{setspace}
% \usepackage{titlepic}
% \usepackage{subfigure}
\usepackage{xcolor}
\usepackage{minted}
\usepackage{lettrine}
\usepackage{xspace}
\usepackage{algpseudocode}
\newcommand{\python}[1]{\spacing{0.7}\inputminted[linenos, numbersep=5pt, frame=lines, framesep=2mm,fontsize=\scriptsize]{python}{#1}}

\definecolor{pastelred}{RGB}{200,80,80}
\definecolor{pastelgreen}{RGB}{0,150,80}

% redefine \texttt to be coloured:
\renewcommand\texttt[1]{{\ttfamily\color{pastelgreen}#1}}

\usepackage[xetex, bookmarksopen, pagebackref]{hyperref}
\usepackage{doi}
\renewcommand*{\backref}[1]{}
\renewcommand*{\backrefalt}[4]{
  \ifnum#1=1
    [p~#2]
  \else
    [pp~#2]
  \fi
}

\hypersetup{
    colorlinks=true,%
    citecolor=pastelred,%
    filecolor=pastelred,%
    linkcolor=pastelred,%
    urlcolor=pastelred
}

% Magic formula for make \hbar not throwing a spurious message
% However, \hbar won't work in text mode, which should not be a problem
\expandafter\let\expandafter\hbar\csname ?-\string\hbar\endcsname
% End of magic code

% This page left intentionally blank:
\makeatletter \def\clearforchapter{
  \clearpage\if@twoside \ifodd\c@page\else \hbox{}\vfill
  \begin{center}This page intentionally left blank
  \end{center}\vfill \thispagestyle{cleared}%
\newpage\if@twocolumn\hbox{}\newpage\fi\fi\fi}\makeatother

\newcommand*{\blankpage}{%
\vspace*{\fill}
\centering This page intentionally left blank
\vspace{\fill}}
\makeatletter
\renewcommand*{\cleardoublepage}{\clearpage\if@twoside \ifodd\c@page\else
\blankpage
\thispagestyle{empty}
\newpage
\if@twocolumn\hbox{}\newpage\fi\fi\fi}
\makeatother

% Make contents go deep
\setcounter{secnumdepth}{5}
\setcounter{tocdepth}{5}

%% Help determine how wide the textblock should be %%
\newlength{\mylen} % a length
\newcommand{\alphabet}{abcdefghijklmnopqrstuvwxyz} % the lowercase alphabet

\settowidth{\mylen}{\alphabet}

%% Make footnotes go in the margin %%
\footnotesinmargin
\setlength{\footmarkwidth}{0em}
\setlength{\footmarksep}{0em}
\setlength{\footparindent}{0em}

\usepackage{ragged2e}

%\renewcommand{\foottextfont}{%
  %\strictpagechecktrue
  %\checkoddpage
  %\ifoddpage
    %\footnotesize\raggedright
  %\else
    %\footnotesize\raggedleft
  %\fi
 %}%

\renewcommand{\foottextfont}{\footnotesize\raggedright}

% \usepackage{marginfix}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%% Defining custom page layout %%%%%%
\settrims{0pt}{0pt}
\settypeblocksize{220.8mm}{4.5in}{*}
\setlrmargins{25.4mm}{*}{*}
\setulmargins{1.5in}{*}{*}
\setmarginnotes{5mm}{40mm}{\onelineskip}
\setheadfoot{\onelineskip}{2\onelineskip}
\setheaderspaces{*}{2\onelineskip}{*}

\checkandfixthelayout
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
